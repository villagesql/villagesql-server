# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
# DB `basic_schema` - created
# Registred SERVICE at path: /svc
# Registred DB_SCHEMA at path: /svc/basic
# Registred DB_OBJECT at path: /svc/basic/t1
# Registred DB_OBJECT at path: /svc/basic/t4
# Registred DB_OBJECT at path: /svc/basic/t2
# Registred DB_OBJECT at path: /svc/basic/proc
# Registred CONTENT_SET at path: /svc/static
# Registred CONTENT_FILE at path: /svc/static/file1
# Registred CONTENT_FILE at path: /svc/static/file2
update mysql_rest_service_metadata.config set data = json_merge_patch(data, '{"responseCache":{"maxCacheSize":200}, "fileCache":{"maxCacheSize":200}}');
update mysql_rest_service_metadata.db_object set options='{"cache_ttl":5}' where name='table1';
update mysql_rest_service_metadata.db_object set options='{"cache_ttl":5}' where name='proc_table4';
GET /svc/basic/t1/1
{
    "id": 1,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t1/1"
        }
    ],
    "_metadata": {
        "etag": "349A978B6EEAC86C01C2D7FD0F0C13EEAEE998366EF4D2B4881E22957865400F"
    }
}
OK
update performance_schema.setup_consumers set enabled=1 where name='events_statements_history';
select count(*) into @before from performance_schema.events_statements_history where sql_text like '%/svc/basic/t1%' and thread_id<>ps_current_thread_id();
GET /svc/basic/t1/20
{
    "id": 20,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t1/20"
        }
    ],
    "_metadata": {
        "etag": "B02684351033D76F7BC8CA1C96BDB1DBD9BB0AEA3CE86034E7554BFAC72D1975"
    }
}
OK
select count(*), @before+1 from performance_schema.events_statements_history where sql_text like '%/svc/basic/t1%' and thread_id<>ps_current_thread_id();
count(*)	@before+1
2	2
select IF(count(*)=@before+1,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%/svc/basic/t1%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+1,'PASS','FAIL')
PASS
GET /svc/basic/t1/20
{
    "id": 20,
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t1/20"
        }
    ],
    "_metadata": {
        "etag": "B02684351033D76F7BC8CA1C96BDB1DBD9BB0AEA3CE86034E7554BFAC72D1975"
    }
}
OK
select IF(count(*)=@before+1,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%/svc/basic/t1%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+1,'PASS','FAIL')
PASS
select count(*) into @before from performance_schema.events_statements_history where sql_text like '%/svc/basic/t2%' and thread_id<>ps_current_thread_id();
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "77004781476882B937CFE9FFC837CC8FC1D13F717B87F6ABCE20142D1C4140D6"
    }
}
OK
select IF(count(*)=@before+1,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%/svc/basic/t2%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+1,'PASS','FAIL')
PASS
GET /svc/basic/t2/1
{
    "id": 1,
    "date": "1977-01-21 00:00:00.000000",
    "name": "First row",
    "links": [
        {
            "rel": "self",
            "href": "/svc/basic/t2/1"
        }
    ],
    "comments": "First comment",
    "_metadata": {
        "etag": "77004781476882B937CFE9FFC837CC8FC1D13F717B87F6ABCE20142D1C4140D6"
    }
}
OK
select IF(count(*)=@before+2,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%/svc/basic/t2%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+2,'PASS','FAIL')
PASS
PUT /svc/basic/proc (payload-size:2)
{
    "resultSets": []
}
OK
PUT /svc/basic/proc (payload-size:2)
{
    "resultSets": []
}
OK
select * from basic_schema.table4;
id	first_name	last_name	table2_id
1	Clarissa	Barton	NULL
2	Haley	White	2
3	George	Simmons	4
4	NEW ROW	NEW ROW	NULL
select count(*) into @before from performance_schema.events_statements_history where sql_text like '%content_file WHERE id=%' and thread_id<>ps_current_thread_id();
select IF(count(*)=@before+1,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%content_file WHERE id=%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+1,'PASS','FAIL')
PASS
select IF(count(*)=@before+1,'PASS','FAIL') from performance_schema.events_statements_history where sql_text like '%content_file WHERE id=%' and thread_id<>ps_current_thread_id();
IF(count(*)=@before+1,'PASS','FAIL')
PASS
DROP SCHEMA basic_schema;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
DROP ROLE mysql_rest_service_dev;
