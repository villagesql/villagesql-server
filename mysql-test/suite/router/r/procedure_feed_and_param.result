# MySQL Rest Service schema created.
# MySQL Rest Service, server accounts configured.
CREATE SCHEMA `mrs`;
CREATE PROCEDURE `mrs`.`mirror` (IN input VARCHAR(3), OUT output1 VARCHAR(3), OUT output2 VARCHAR(3))
BEGIN
SELECT input INTO output1;
SELECT input  INTO output2;
SELECT input  AS output3, input  AS output4;
SELECT input  AS output5;
END;//
CREATE PROCEDURE `mrs`.`proc_do_nothing` ()
BEGIN
END;//


## I. Verify error messages while providing faulty configuration to rest procedure
#
# 1. POST request is not supported by object/procedures
# 2. DELETE request is not supported by object/procedures
# 3. PUT request is rejected when there is not payload proveided
# 4. PUT request is rejected when the payload is not JSON object
# 5. PUT request is rejected when the payloads, JSON object field
#    doesn't match registred input parameters.
# 6. GET request is rejected when the URL parameter name doesn'
#    match registred input parameters.
#
#
# Registred SERVICE at path: /svc
# Registred DB_SCHEMA at path: /svc/proc
# Registred DB_OBJECT at path: /svc/proc/mirror
# Registred DB_OBJECT at path: /svc/proc/nothing
GET /svc/proc/nothing
{
    "resultSets": []
}
OK

#
# III.6
GET /svc/proc/mirror?input=1
{
    "resultSets": [
        {
            "type": "FirstResultset",
            "items": [
                {
                    "output3": "1",
                    "output4": "1"
                }
            ],
            "_metadata": {
                "columns": [
                    {
                        "name": "output3",
                        "type": "VARCHAR(3)"
                    },
                    {
                        "name": "output4",
                        "type": "VARCHAR(3)"
                    }
                ]
            }
        },
        {
            "type": "SecondResultset",
            "items": [
                {
                    "output5": "1"
                }
            ],
            "_metadata": {
                "columns": [
                    {
                        "name": "output5",
                        "type": "VARCHAR(3)"
                    }
                ]
            }
        }
    ],
    "outParameters": {
        "output1": "MQ==",
        "output2": "MQ=="
    }
}
OK

#
# IV.1
PUT /svc/proc/mirror (payload-size:12)
{
    "resultSets": [
        {
            "type": "FirstResultset",
            "items": [
                {
                    "output3": "10",
                    "output4": "10"
                }
            ],
            "_metadata": {
                "columns": [
                    {
                        "name": "output3",
                        "type": "VARCHAR(3)"
                    },
                    {
                        "name": "output4",
                        "type": "VARCHAR(3)"
                    }
                ]
            }
        },
        {
            "type": "SecondResultset",
            "items": [
                {
                    "output5": "10"
                }
            ],
            "_metadata": {
                "columns": [
                    {
                        "name": "output5",
                        "type": "VARCHAR(3)"
                    }
                ]
            }
        }
    ],
    "outParameters": {
        "output1": "MTA=",
        "output2": "MTA="
    }
}
OK
DROP SCHEMA mrs;
DROP SCHEMA mysql_rest_service_metadata;
DROP ROLE mysql_rest_service_admin;
DROP ROLE mysql_rest_service_schema_admin;
DROP ROLE mysql_rest_service_meta_provider;
DROP ROLE mysql_rest_service_data_provider;
DROP ROLE mysql_rest_service_dev;
