# Test Correlated Subqueries with COMPLEX type
# Grammar: SELECT ... WHERE col = (SELECT ... WHERE outer.col = inner.col)

--source include/villagesql/install_complex_extension.inc

CREATE TABLE t1 (id INT, val COMPLEX);
INSERT INTO t1 VALUES (1, '(1.0,2.0)'), (2, '(3.0,4.0)');

CREATE TABLE t2 (id INT, val COMPLEX);
INSERT INTO t2 VALUES (1, '(1.0,2.0)'), (1, '(5.0,6.0)'), (2, '(3.0,4.0)');

# Correlated scalar subquery
SELECT id, (SELECT val FROM t2 WHERE t2.id = t1.id LIMIT 1) as sub_val FROM t1;

# Correlated IN subquery
SELECT * FROM t1 WHERE val IN (SELECT val FROM t2 WHERE t2.id = t1.id);

DROP TABLE t1;
DROP TABLE t2;

--source include/villagesql/uninstall_complex_extension.inc
