include/rpl/init_source_replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
stop replica;
## CREATE TABLE in master with custom Blob inline size
CREATE TABLE test.t1 (a int primary key,
b blob comment "NDB_COLUMN=BLOB_INLINE_SIZE=64",
bm mediumblob comment "NDB_COLUMN=BLOB_INLINE_SIZE=700",
bl longblob,
t text comment "NDB_COLUMN=BLOB_INLINE_SIZE=100",
tm mediumtext comment "NDB_COLUMN=BLOB_INLINE_SIZE=512",
tl longtext comment "NDB_COLUMN=BLOB_INLINE_SIZE=128")
engine=ndb;
## Verify inline and partition sizes of test.t1 on master
SELECT inline_size, part_size FROM ndbinfo.blobs WHERE table_name = 't1';
inline_size	part_size
64	2000
700	4000
256	13948
100	2000
512	4000
128	13948
reset binary logs and gtids;
## Create table in replica with other custom Blob inline size
CREATE TABLE test.t1 (a int primary key,
b blob comment "NDB_COLUMN=BLOB_INLINE_SIZE=96",
bm mediumblob comment "NDB_COLUMN=BLOB_INLINE_SIZE=456",
bl longblob comment "NDB_COLUMN=BLOB_INLINE_SIZE=766",
t text,
tm mediumtext comment "NDB_COLUMN=BLOB_INLINE_SIZE=255",
tl longtext comment "NDB_COLUMN=BLOB_INLINE_SIZE=255") 
engine=ndb;
start replica;
## Verify inline and partition sizes of test.t1 on replica
SELECT inline_size, part_size FROM ndbinfo.blobs WHERE table_name = 't1';
inline_size	part_size
96	2000
456	4000
766	13948
256	2000
255	4000
255	13948
## Connect to master and insert values on test.t1
INSERT INTO test.t1 VALUES
(
1,
repeat('J',60000),
repeat('J',60000),
repeat('J',60000),
repeat(_utf32 0x1F47E,15000),
repeat(_utf32 0x1F47E,60000),
repeat(_utf32 0x1F47E,60000)),
(
2,
repeat('K',60000),
repeat('K',60000),
repeat('K',60000),
repeat(_utf32 0x1F47D,15000),
repeat(_utf32 0x1F47D,60000),
repeat(_utf32 0x1F47D,60000)),
(
3,
repeat('L',60000),
repeat('L',60000),
repeat('L',60000),
repeat(_utf32 0x1F47C,15000),
repeat(_utf32 0x1F47C,60000),
repeat(_utf32 0x1F47C,60000));

## Verify inserted values on master, sync and verify those on replica
SELECT a, sha2(b,256), sha2(bm,256), sha2(bl,256), sha2(t,256), sha2(tm,256), sha2(tl,256) FROM test.t1 ORDER BY a;
a	sha2(b,256)	sha2(bm,256)	sha2(bl,256)	sha2(t,256)	sha2(tm,256)	sha2(tl,256)
1	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	4ef9d784f848b095cc0b7d44159b7751f674fbd1afab19cabdd6fd23f1ef0633	7d41eb653287609ae6f4d1038ab523d6d3559b87e2d6f924ebabd8f11a4e5472	7d41eb653287609ae6f4d1038ab523d6d3559b87e2d6f924ebabd8f11a4e5472
2	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	d75def782a9ed73564284dd687b9d386b4c6fd5b405eeb7de0cfc79578cc34d5	7781bf4ba63b8c3ae51713f53d0b16801de2b1a6983239d55e4b678d64bffb23	7781bf4ba63b8c3ae51713f53d0b16801de2b1a6983239d55e4b678d64bffb23
3	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	9cf3f61ec22193542af0f62ec8ac0c4812306853b0993861c91cd9749ed89ef5	084fb30eec927cbb7a127199be175aa1ad85aba1579b619c660f9b713721cb69	084fb30eec927cbb7a127199be175aa1ad85aba1579b619c660f9b713721cb69
SELECT a, sha2(b,256), sha2(bm,256), sha2(bl,256), sha2(t,256), sha2(tm,256), sha2(tl,256) FROM test.t1 ORDER BY a;
a	sha2(b,256)	sha2(bm,256)	sha2(bl,256)	sha2(t,256)	sha2(tm,256)	sha2(tl,256)
1	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	d447845737bd8db02ca7e05ada83cba9674392b82e916469105388a75acaf623	4ef9d784f848b095cc0b7d44159b7751f674fbd1afab19cabdd6fd23f1ef0633	7d41eb653287609ae6f4d1038ab523d6d3559b87e2d6f924ebabd8f11a4e5472	7d41eb653287609ae6f4d1038ab523d6d3559b87e2d6f924ebabd8f11a4e5472
2	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	c5a04125b42123c433b5e17cff43f68ff0c51204baf88d6e2d163590fc069a33	d75def782a9ed73564284dd687b9d386b4c6fd5b405eeb7de0cfc79578cc34d5	7781bf4ba63b8c3ae51713f53d0b16801de2b1a6983239d55e4b678d64bffb23	7781bf4ba63b8c3ae51713f53d0b16801de2b1a6983239d55e4b678d64bffb23
3	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	e4e6f7d4f35f40f49e9390d8f29a941e19b651eccc8e6fab20271e7321517940	9cf3f61ec22193542af0f62ec8ac0c4812306853b0993861c91cd9749ed89ef5	084fb30eec927cbb7a127199be175aa1ad85aba1579b619c660f9b713721cb69	084fb30eec927cbb7a127199be175aa1ad85aba1579b619c660f9b713721cb69

## Update values on master, verify, sync and verify those on replica
UPDATE test.t1 SET
b=left(b,59000),
bm=left(bm, 59000),
bl=left(bl, 59000),
t=left(t,14000),
tm=left(tm, 59000),
tl=left(tl, 59000);
SELECT a, sha2(b,256), sha2(bm,256), sha2(bl,256), sha2(t,256), sha2(tm,256), sha2(tl,256) FROM test.t1 order by a;
a	sha2(b,256)	sha2(bm,256)	sha2(bl,256)	sha2(t,256)	sha2(tm,256)	sha2(tl,256)
1	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	63df77cf4e07fac1430ca50b94ed97c85730ff1762bf0eadf0f7b373166ebedc	0dbbe8b1e6b54ba7703f9f350242e776bbd0a9a638e687aa8c0b2badd49e91d3	0dbbe8b1e6b54ba7703f9f350242e776bbd0a9a638e687aa8c0b2badd49e91d3
2	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	bda06937590f0aae56c6556c9ecff86004b684443033b4cd6d8329496d47a9b9	23f7a7a237f78c754be716dfde73ba08dbe35208e7e68e44204c623dc3eed2ee	23f7a7a237f78c754be716dfde73ba08dbe35208e7e68e44204c623dc3eed2ee
3	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	f9d29b46a4d49c9bb0d9df4490fc9a46213e2a1fd18f2ce3f9e8758fdcb5099b	1c25bc6d7d0a1da714f489bd45eb7c65ed6efadf2d891ba7cc7737c0afb8c76e	1c25bc6d7d0a1da714f489bd45eb7c65ed6efadf2d891ba7cc7737c0afb8c76e
SELECT a, sha2(b,256), sha2(bm,256), sha2(bl,256), sha2(t,256), sha2(tm,256), sha2(tl,256) FROM test.t1 order by a;
a	sha2(b,256)	sha2(bm,256)	sha2(bl,256)	sha2(t,256)	sha2(tm,256)	sha2(tl,256)
1	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	54ed0ed1c4e71e3585f4c0d3f857e2f5a68a1adc93edcfe6174d4557c8e91c42	63df77cf4e07fac1430ca50b94ed97c85730ff1762bf0eadf0f7b373166ebedc	0dbbe8b1e6b54ba7703f9f350242e776bbd0a9a638e687aa8c0b2badd49e91d3	0dbbe8b1e6b54ba7703f9f350242e776bbd0a9a638e687aa8c0b2badd49e91d3
2	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	f01ae196a094a9a6fbda67105f26a6715c0508cd4de7cfef55eaa2ed803ae7ea	bda06937590f0aae56c6556c9ecff86004b684443033b4cd6d8329496d47a9b9	23f7a7a237f78c754be716dfde73ba08dbe35208e7e68e44204c623dc3eed2ee	23f7a7a237f78c754be716dfde73ba08dbe35208e7e68e44204c623dc3eed2ee
3	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	fb63bfc1c385fd10d2dfd03707b707a32d1754301a3b7aad9ad1dc9460381b9a	f9d29b46a4d49c9bb0d9df4490fc9a46213e2a1fd18f2ce3f9e8758fdcb5099b	1c25bc6d7d0a1da714f489bd45eb7c65ed6efadf2d891ba7cc7737c0afb8c76e	1c25bc6d7d0a1da714f489bd45eb7c65ed6efadf2d891ba7cc7737c0afb8c76e

## Delete on master, sync and verify deletion on replica
DELETE FROM test.t1;
SELECT a, sha2(b,256), sha2(bm,256), sha2(bl,256), sha2(t,256), sha2(tm,256), sha2(tl,256) FROM test.t1 order by a;
a	sha2(b,256)	sha2(bm,256)	sha2(bl,256)	sha2(t,256)	sha2(tm,256)	sha2(tl,256)
DROP TABLE test.t1;
include/rpl/deinit.inc
