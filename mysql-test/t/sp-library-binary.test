--echo #
--echo # WL#16824: WASM library server support.
--echo #

CREATE LIBRARY binary_library_utf8 LANGUAGE WASM
AS $$cHJpbnRmKCdUaGlzIGlzIFdBU00nKTs=$$;
SHOW CREATE LIBRARY binary_library_utf8;
ALTER LIBRARY binary_library_utf8 COMMENT 'A binary library stored in UTF8 encoding.';

CREATE LIBRARY binary_library_hex LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS 0x7072696E7466282754686973206973205741534D27293B;
SHOW CREATE LIBRARY binary_library_hex;
ALTER LIBRARY binary_library_hex COMMENT 'A binary library stored in BINARY encoding.';

CREATE LIBRARY binary_library_quotes LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS _binary X'7072696E7466282754686973206973205741534D20776974682071756F74657327293B';
SHOW CREATE LIBRARY binary_library_quotes;

CREATE LIBRARY binary_library_binary LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS _binary b'111000011100101101001110111011101001100110101000100111101010011010001101001111001110000011010011110011100000101011110000011010011100110110000011010011101110100000110001011010011101110110000111100101111001100111101001111011';
SHOW CREATE LIBRARY binary_library_binary;

CREATE LIBRARY binary_library_with_0 LANGUAGE WASM
COMMENT 'A binary library containg leading and trailing 0s' AS 0x0000000089ABCDEF00000000;
SHOW CREATE LIBRARY binary_library_with_0;

CREATE LIBRARY binary_library_0 LANGUAGE WASM
COMMENT 'A binary library using just 0' AS 0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;
SHOW CREATE LIBRARY binary_library_0;

--echo # Negative tests:
--error ER_PARSE_ERROR
CREATE LIBRARY binary_library_binary_neg LANGUAGE WASM
AS _binary b'01210';
--error ER_PARSE_ERROR
CREATE LIBRARY binary_library_hex_neg LANGUAGE WASM
AS _binary X'ABCDEFGH';
--error ER_PARSE_ERROR
CREATE LIBRARY binary_library_null LANGUAGE WASM
AS _binary NULL;
--error ER_PARSE_ERROR
CREATE LIBRARY binary_library_null LANGUAGE WASM
AS NULL;
--error ER_PARSE_ERROR
CREATE LIBRARY binary_library_neg LANGUAGE WASM
AS 0xABCDEFGH;
CREATE LIBRARY binary_library_neg LANGUAGE WASM
AS 'This is not Base64 encoded text';

--replace_column 6 <created> 7 <modified>
SELECT * FROM INFORMATION_SCHEMA.LIBRARIES
WHERE LIBRARY_SCHEMA = 'test'
ORDER BY LIBRARY_NAME;

--sorted_result
--replace_column 5 <modified> 6 <created>
SHOW LIBRARY STATUS like 'binary_library_%';

--echo # Cleanup.

DROP LIBRARY binary_library_0;
DROP LIBRARY binary_library_with_0;
DROP LIBRARY binary_library_neg;
DROP LIBRARY binary_library_binary;
DROP LIBRARY binary_library_quotes;
DROP LIBRARY binary_library_hex;
DROP LIBRARY binary_library_utf8;

SELECT * FROM INFORMATION_SCHEMA.LIBRARIES
WHERE LIBRARY_SCHEMA = 'test';

