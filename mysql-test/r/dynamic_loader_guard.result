#
# This tests checks dynamic loader rollback
# for case when component's init() fails.
#

# force the component init() to fail and expect an error
SET DEBUG = '+d,force_component_init_failure';
INSTALL COMPONENT "file://component_test_component_init_then_register";
ERROR HY000: Initialization method provided by component 'mysql:test_component_init_then_register' failed.

# unset debug flag for cleanup
SET DEBUG = '-d,force_component_init_failure';

# check the component is not installed
SELECT COUNT(component_urn) FROM mysql.component WHERE component_urn='file://component_test_component_init_then_register';
COUNT(component_urn)
0
