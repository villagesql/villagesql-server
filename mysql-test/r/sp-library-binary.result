#
# WL#16824: WASM library server support.
#
CREATE LIBRARY binary_library_utf8 LANGUAGE WASM
AS $$cHJpbnRmKCdUaGlzIGlzIFdBU00nKTs=$$;
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_utf8;
Library	sql_mode	Create Library
binary_library_utf8	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_utf8`
    LANGUAGE WASM
AS $$cHJpbnRmKCdUaGlzIGlzIFdBU00nKTs=$$
ALTER LIBRARY binary_library_utf8 COMMENT 'A binary library stored in UTF8 encoding.';
CREATE LIBRARY binary_library_hex LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS 0x7072696E7466282754686973206973205741534D27293B;
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_hex;
Library	sql_mode	Create Library
binary_library_hex	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_hex`
    COMMENT 'A binary library stored in binary encoding'
    LANGUAGE WASM
AS 0x7072696E7466282754686973206973205741534D27293B
ALTER LIBRARY binary_library_hex COMMENT 'A binary library stored in BINARY encoding.';
CREATE LIBRARY binary_library_quotes LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS _binary X'7072696E7466282754686973206973205741534D20776974682071756F74657327293B';
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_quotes;
Library	sql_mode	Create Library
binary_library_quotes	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_quotes`
    COMMENT 'A binary library stored in binary encoding'
    LANGUAGE WASM
AS 0x7072696E7466282754686973206973205741534D20776974682071756F74657327293B
CREATE LIBRARY binary_library_binary LANGUAGE WASM
COMMENT 'A binary library stored in binary encoding'
AS _binary b'111000011100101101001110111011101001100110101000100111101010011010001101001111001110000011010011110011100000101011110000011010011100110110000011010011101110100000110001011010011101110110000111100101111001100111101001111011';
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_binary;
Library	sql_mode	Create Library
binary_library_binary	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_binary`
    COMMENT 'A binary library stored in binary encoding'
    LANGUAGE WASM
AS 0x3872D3BBA66A27A9A34F3834F382BC1A7360D3BA0C5A7761E5E67A7B
CREATE LIBRARY binary_library_with_0 LANGUAGE WASM
COMMENT 'A binary library containg leading and trailing 0s' AS 0x0000000089ABCDEF00000000;
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_with_0;
Library	sql_mode	Create Library
binary_library_with_0	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_with_0`
    COMMENT 'A binary library containg leading and trailing 0s'
    LANGUAGE WASM
AS 0x0000000089ABCDEF00000000
CREATE LIBRARY binary_library_0 LANGUAGE WASM
COMMENT 'A binary library using just 0' AS 0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;
Warnings:
Warning	6001	Language component: Not available.
SHOW CREATE LIBRARY binary_library_0;
Library	sql_mode	Create Library
binary_library_0	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	CREATE LIBRARY `binary_library_0`
    COMMENT 'A binary library using just 0'
    LANGUAGE WASM
AS 0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
# Negative tests:
CREATE LIBRARY binary_library_binary_neg LANGUAGE WASM
AS _binary b'01210';
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'b'01210'' at line 2
CREATE LIBRARY binary_library_hex_neg LANGUAGE WASM
AS _binary X'ABCDEFGH';
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'X'ABCDEFGH'' at line 2
CREATE LIBRARY binary_library_null LANGUAGE WASM
AS _binary NULL;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'NULL' at line 2
CREATE LIBRARY binary_library_null LANGUAGE WASM
AS NULL;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'NULL' at line 2
CREATE LIBRARY binary_library_neg LANGUAGE WASM
AS 0xABCDEFGH;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '0xABCDEFGH' at line 2
CREATE LIBRARY binary_library_neg LANGUAGE WASM
AS 'This is not Base64 encoded text';
Warnings:
Warning	6001	Language component: Not available.
SELECT * FROM INFORMATION_SCHEMA.LIBRARIES
WHERE LIBRARY_SCHEMA = 'test'
ORDER BY LIBRARY_NAME;
LIBRARY_CATALOG	LIBRARY_SCHEMA	LIBRARY_NAME	LIBRARY_DEFINITION	LANGUAGE	CREATED	LAST_ALTERED	SQL_MODE	LIBRARY_COMMENT	CREATOR
def	test	binary_library_0		WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library using just 0	root@localhost
def	test	binary_library_binary		WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library stored in binary encoding	root@localhost
def	test	binary_library_hex		WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library stored in BINARY encoding.	root@localhost
def	test	binary_library_neg	This is not Base64 encoded text	WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION		root@localhost
def	test	binary_library_quotes		WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library stored in binary encoding	root@localhost
def	test	binary_library_utf8	cHJpbnRmKCdUaGlzIGlzIFdBU00nKTs=	WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library stored in UTF8 encoding.	root@localhost
def	test	binary_library_with_0		WASM	<created>	<modified>	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	A binary library containg leading and trailing 0s	root@localhost
SHOW LIBRARY STATUS like 'binary_library_%';
Db	Name	Language	Creator	Modified	Created	Comment
test	binary_library_0	WASM	root@localhost	<modified>	<created>	A binary library using just 0
test	binary_library_binary	WASM	root@localhost	<modified>	<created>	A binary library stored in binary encoding
test	binary_library_hex	WASM	root@localhost	<modified>	<created>	A binary library stored in BINARY encoding.
test	binary_library_neg	WASM	root@localhost	<modified>	<created>	
test	binary_library_quotes	WASM	root@localhost	<modified>	<created>	A binary library stored in binary encoding
test	binary_library_utf8	WASM	root@localhost	<modified>	<created>	A binary library stored in UTF8 encoding.
test	binary_library_with_0	WASM	root@localhost	<modified>	<created>	A binary library containg leading and trailing 0s
# Cleanup.
DROP LIBRARY binary_library_0;
DROP LIBRARY binary_library_with_0;
DROP LIBRARY binary_library_neg;
DROP LIBRARY binary_library_binary;
DROP LIBRARY binary_library_quotes;
DROP LIBRARY binary_library_hex;
DROP LIBRARY binary_library_utf8;
SELECT * FROM INFORMATION_SCHEMA.LIBRARIES
WHERE LIBRARY_SCHEMA = 'test';
LIBRARY_CATALOG	LIBRARY_SCHEMA	LIBRARY_NAME	LIBRARY_DEFINITION	LANGUAGE	CREATED	LAST_ALTERED	SQL_MODE	LIBRARY_COMMENT	CREATOR
